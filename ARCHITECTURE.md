# æŠ€æœ¯æ¶æ„æ–‡æ¡£ | Architecture Documentation

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Getç¬”è®° Importer çš„æŠ€æœ¯æ¶æ„ã€è®¾è®¡å†³ç­–å’Œå®ç°ç»†èŠ‚ã€‚

[ä¸­æ–‡](#ä¸­æ–‡) | [English](#english)

---

## ä¸­æ–‡

### ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è§ˆ](#ç³»ç»Ÿæ¦‚è§ˆ)
- [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
- [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
- [æ ¸å¿ƒç®—æ³•](#æ ¸å¿ƒç®—æ³•)
- [å…³é”®è®¾è®¡å†³ç­–](#å…³é”®è®¾è®¡å†³ç­–)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)

---

## ç³»ç»Ÿæ¦‚è§ˆ

Getç¬”è®° Importer æ˜¯ä¸€ä¸ª Obsidian æ’ä»¶ï¼Œç”¨äºå°† Getç¬”è®° çš„å†…å®¹åŒæ­¥åˆ° Obsidian vaultã€‚æ’ä»¶ä½¿ç”¨æµè§ˆå™¨è‡ªåŠ¨åŒ–æŠ€æœ¯ï¼ˆPlaywrightï¼‰ç™»å½• Getç¬”è®°ã€å¯¼å‡ºæ•°æ®ï¼Œç„¶åè§£æ HTML å¹¶è½¬æ¢ä¸º Markdown æ ¼å¼ä¿å­˜ã€‚

### æ¶æ„åŸåˆ™

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼ŒèŒè´£æ¸…æ™°
2. **æ•°æ®é©±åŠ¨**ï¼šåŸºäºå”¯ä¸€ ID çš„å¢é‡åŒæ­¥æœºåˆ¶
3. **ç”¨æˆ·å‹å¥½**ï¼šè‡ªåŠ¨åŒ–ç¨‹åº¦é«˜ï¼Œå‡å°‘ç”¨æˆ·æ“ä½œ
4. **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„å¯è§†åŒ–æ–¹å¼æˆ–åŒæ­¥é€‰é¡¹

---

## æ ¸å¿ƒæ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Obsidian App                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Getç¬”è®° Importer Plugin                   â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚   UI     â”‚  â”‚  Core    â”‚  â”‚   Integration    â”‚    â”‚  â”‚
â”‚  â”‚  â”‚ Layer    â”‚â†’ â”‚  Logic   â”‚â†’ â”‚     Layer        â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚       â†“             â†“                  â†“              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  Auth    â”‚  â”‚  Parser  â”‚  â”‚   Obsidian       â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  System  â”‚  â”‚  Engine  â”‚  â”‚   Vault API      â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†•
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Playwright  â”‚
                    â”‚   Browser    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†•
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Getç¬”è®°    â”‚
                    â”‚   Website    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—è¯´æ˜

#### 1. UI Layerï¼ˆç”¨æˆ·ç•Œé¢å±‚ï¼‰
**ä½ç½®**: `lib/ui/`

- **auth_ui.ts**: è®¤è¯ç•Œé¢ï¼Œå¤„ç†ç™»å½•æµç¨‹
- **main_ui.ts**: ä¸»ç•Œé¢ï¼Œæ˜¾ç¤ºè®¾ç½®å’ŒåŒæ­¥é€‰é¡¹
- **manualsync_ui.ts**: æ‰‹åŠ¨å¯¼å…¥ ZIP æ–‡ä»¶ç•Œé¢
- **message_ui.ts**: æ¶ˆæ¯é€šçŸ¥ç»„ä»¶

**èŒè´£**:
- æ¸²æŸ“ç”¨æˆ·ç•Œé¢
- æ”¶é›†ç”¨æˆ·è¾“å…¥
- æ˜¾ç¤ºåŒæ­¥çŠ¶æ€å’Œè¿›åº¦
- é”™è¯¯æç¤º

#### 2. Core Logicï¼ˆæ ¸å¿ƒé€»è¾‘å±‚ï¼‰
**ä½ç½®**: `lib/get/`

- **auth.ts** (`GetAuth`): è®¤è¯ç®¡ç†
- **exporter.ts** (`GetExporter`): æ•°æ®å¯¼å‡º
- **core.ts** (`GetCore`): HTML è§£æå’Œæ•°æ®å¤„ç†
- **importer.ts** (`GetImporter`): å¯¼å…¥åè°ƒå™¨
- **const.ts**: å¸¸é‡å®šä¹‰

**èŒè´£**:
- æµè§ˆå™¨è‡ªåŠ¨åŒ–
- HTML è§£æ
- æ•°æ®è½¬æ¢
- æ–‡ä»¶æ“ä½œ

#### 3. Integration Layerï¼ˆé›†æˆå±‚ï¼‰
**ä½ç½®**: `lib/obIntegration/`

- **canvas.ts**: Canvas ç”Ÿæˆ
- **moments.ts**: Moments ç”Ÿæˆ

**èŒè´£**:
- ç”Ÿæˆ Obsidian ç‰¹å®šæ ¼å¼
- åˆ›å»ºå¯è§†åŒ–æ–‡ä»¶

#### 4. Main Entryï¼ˆå…¥å£ç‚¹ï¼‰
**ä½ç½®**: `main.ts`

- `GetImporterPlugin` ç±»
- æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
- è®¾ç½®ç®¡ç†
- è‡ªåŠ¨åŒæ­¥è°ƒåº¦

---

## æ•°æ®æµç¨‹

### å®Œæ•´åŒæ­¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è§¦å‘åŒæ­¥                                                  â”‚
â”‚    â€¢ ç”¨æˆ·ç‚¹å‡»"ç«‹å³åŒæ­¥"                                       â”‚
â”‚    â€¢ å¯åŠ¨æ—¶è‡ªåŠ¨åŒæ­¥                                          â”‚
â”‚    â€¢ å®šæ—¶è‡ªåŠ¨åŒæ­¥                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ£€æŸ¥è®¤è¯çŠ¶æ€                                              â”‚
â”‚    GetAuth.checkAuthStatus()                                â”‚
â”‚    â€¢ è¯»å–ç¼“å­˜çš„è®¤è¯æ–‡ä»¶                                       â”‚
â”‚    â€¢ éªŒè¯æ˜¯å¦è¿‡æœŸ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚ å·²è®¤è¯ï¼Ÿ â”‚
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                  å¦ â†â”€â”€â”€â”˜    â””â”€â”€â”€â†’ æ˜¯
                  â†“                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3a. æ‰§è¡Œç™»å½•             â”‚  â”‚ 3b. è·³è¿‡ç™»å½•                  â”‚
â”‚  GetAuth.login()        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â€¢ æ‰“å¼€æµè§ˆå™¨            â”‚
â”‚  â€¢ ç”¨æˆ·æ‰‹åŠ¨ç™»å½•          â”‚
â”‚  â€¢ ä¿å­˜è®¤è¯ä¿¡æ¯          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å¯¼å‡ºæ•°æ®                                                  â”‚
â”‚    GetExporter.export()                                     â”‚
â”‚    â€¢ ä½¿ç”¨ Playwright æ‰“å¼€ Getç¬”è®°                            â”‚
â”‚    â€¢ å¯¼èˆªåˆ°å¯¼å‡ºé¡µé¢                                          â”‚
â”‚    â€¢ ä¸‹è½½ HTML å¤‡ä»½æ–‡ä»¶                                       â”‚
â”‚    â€¢ ä¿å­˜åˆ° ~/.get/cache/playwright/get_export.zip        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è§£æ HTML                                                 â”‚
â”‚    GetCore.constructor()                                    â”‚
â”‚    â€¢ ä½¿ç”¨ node-html-parser è§£æ HTML                         â”‚
â”‚    â€¢ æå–æ‰€æœ‰ <div class="memo"> å…ƒç´                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ç”Ÿæˆå”¯ä¸€ ID                                               â”‚
â”‚    GetCore.generateMemoId()                                 â”‚
â”‚    â€¢ æ—¶é—´æˆ³: memo.dateTime                                  â”‚
â”‚    â€¢ å†…å®¹å“ˆå¸Œ: hash(title + content + attachments)          â”‚
â”‚    â€¢ å‡ºç°æ¬¡æ•°: åŒä¸€æ—¶é—´æˆ³çš„è®¡æ•°å™¨                             â”‚
â”‚    â€¢ æ€»æ•°: å…¨å±€åºåˆ—å·                                         â”‚
â”‚    æ ¼å¼: ${timestamp}_${hash}_${occurrence}_${total}        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å¢é‡è¿‡æ»¤                                                  â”‚
â”‚    GetCore.loadMemos()                                      â”‚
â”‚    â€¢ éå†æ‰€æœ‰è§£æçš„ memo                                      â”‚
â”‚    â€¢ æ£€æŸ¥ ID æ˜¯å¦åœ¨ syncedMemoIds æ•°ç»„ä¸­                      â”‚
â”‚    â€¢ å¦‚æœä¸åœ¨ â†’ æ·»åŠ åˆ° newMemos åˆ—è¡¨                          â”‚
â”‚    â€¢ å¦‚æœåœ¨ â†’ è·³è¿‡                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. è½¬æ¢ä¸º Markdown                                           â”‚
â”‚    GetImporter.importMemos()                                â”‚
â”‚    â€¢ ä½¿ç”¨ turndown å°† HTML è½¬ä¸º Markdown                     â”‚
â”‚    â€¢ è½¬æ¢é«˜äº®: <mark> â†’ ==text==                             â”‚
â”‚    â€¢ å¤„ç†å›¾ç‰‡é“¾æ¥                                            â”‚
â”‚    â€¢ ç”Ÿæˆ frontmatter                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. å†™å…¥ Vault                                                â”‚
â”‚    app.vault.adapter.write()                                â”‚
â”‚    â€¢ åˆ›å»ºç›®å½•ç»“æ„: get/memos/YYYY-MM-DD/                     â”‚
â”‚    â€¢ å†™å…¥ Markdown æ–‡ä»¶                                       â”‚
â”‚    â€¢ å¤åˆ¶é™„ä»¶åˆ° get attachment/                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. ç”Ÿæˆå¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰                                        â”‚
â”‚     â€¢ generateMoments(): åˆ›å»ºæ—¶é—´çº¿                          â”‚
â”‚     â€¢ generateCanvas(): åˆ›å»ºç”»å¸ƒ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. æ›´æ–°åŒæ­¥çŠ¶æ€                                             â”‚
â”‚     plugin.settings.syncedMemoIds.push(...newMemoIds)      â”‚
â”‚     plugin.settings.lastSyncTime = Date.now()              â”‚
â”‚     plugin.saveSettings()                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. æ˜¾ç¤ºç»“æœ                                                 â”‚
â”‚     new Notice("ğŸ‰ å¯¼å…¥å®Œæˆ. æ€»æ•°: X, æ–°å¢: Y")               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒç®—æ³•

### 1. å¢é‡åŒæ­¥ç®—æ³•

**ç›®æ ‡**: åªå¯¼å…¥æ–°ç¬”è®°ï¼Œé¿å…é‡å¤

**å®ç°**:

```typescript
// lib/get/core.ts

generateMemoId(memo: any, occurrence: number, total: number): string {
  // 1. æå–æ—¶é—´æˆ³
  const timestamp = memo.dateTime; // ä¾‹å¦‚: "2024-01-15T10:30:00"

  // 2. è®¡ç®—å†…å®¹å“ˆå¸Œ
  const contentString =
    (memo.title || '') +
    (memo.content || '') +
    (memo.attachments || []).join('');

  let hash = 0;
  for (let i = 0; i < contentString.length; i++) {
    hash = ((hash << 5) - hash) + contentString.charCodeAt(i);
    hash = hash & hash; // Convert to 32-bit integer
  }

  // 3. ç”Ÿæˆå”¯ä¸€ ID
  return `${timestamp}_${Math.abs(hash)}_${occurrence}_${total}`;
}

// åœ¨ loadMemos() ä¸­ä½¿ç”¨
loadMemos() {
  const occurrenceMap = new Map<string, number>();
  let total = 0;

  for (const memoEl of this.memoElements) {
    total++;

    // ç»Ÿè®¡åŒä¸€æ—¶é—´æˆ³çš„å‡ºç°æ¬¡æ•°
    const occurrence = occurrenceMap.get(memo.dateTime) || 0;
    occurrenceMap.set(memo.dateTime, occurrence + 1);

    // ç”Ÿæˆ ID
    const memoId = this.generateMemoId(memo, occurrence, total);

    // æ£€æŸ¥æ˜¯å¦å·²åŒæ­¥
    if (!this.syncedMemoIds.includes(memoId)) {
      // æ–°ç¬”è®°ï¼
      this.memos.push(memo);
      this.syncedMemoIds.push(memoId);
      this.newMemosCount++;
    }
  }
}
```

**å…³é”®ç‚¹**:
- ä½¿ç”¨ `æ—¶é—´æˆ³ + å†…å®¹å“ˆå¸Œ` ç¡®ä¿å”¯ä¸€æ€§
- `occurrence` è®¡æ•°å™¨å¤„ç†åŒä¸€ç§’çš„å¤šæ¡ç¬”è®°
- `total` æä¾›å…¨å±€åºåˆ—å·
- å‘åå…¼å®¹æ—§ç‰ˆæœ¬çš„ ID æ ¼å¼

---

### 2. HTML è§£æç®—æ³•

**æŒ‘æˆ˜**: Getç¬”è®° å¯¼å‡ºçš„ HTML ç»“æ„å¤æ‚

**è§£å†³æ–¹æ¡ˆ**:

```typescript
// lib/get/core.ts

parse(htmlData: string) {
  // 1. è§£æ HTML
  const root = parse(htmlData);

  // 2. æŸ¥æ‰¾æ‰€æœ‰ memo å…ƒç´ 
  this.memoElements = root.querySelectorAll('div.memo');

  // 3. æå–æ¯ä¸ª memo çš„æ•°æ®
  for (const noteEl of this.memoElements) {
    const memo = {
      dateTime: this.extractDateTime(noteEl),
      title: this.extractTitle(noteEl),
      content: this.extractContent(noteEl),
      tags: this.extractTags(noteEl),
      attachments: this.extractAttachments(noteEl)
    };

    // å¤„ç† memo...
  }
}

// å†…å®¹æå–
extractContent(noteEl: HTMLElement): string {
  // å…‹éš†èŠ‚ç‚¹é¿å…ä¿®æ”¹åŸå§‹ DOM
  const contentEl = parse(noteEl.toString());

  // ç§»é™¤ä¸éœ€è¦çš„å…ƒç´ 
  contentEl.querySelectorAll('.memo-header').forEach(el => el.remove());
  contentEl.querySelectorAll('.memo-footer').forEach(el => el.remove());

  // è½¬æ¢ä¸º Markdown
  const markdown = turndown.turndown(contentEl.toString());

  return markdown;
}
```

---

### 3. é™„ä»¶å¤„ç†ç®—æ³•

**Getç¬”è®° å¯¼å‡ºç»“æ„**:
```
get_export.zip
â”œâ”€â”€ index.html
â””â”€â”€ file/
    â”œâ”€â”€ 2024-01-15/
    â”‚   â”œâ”€â”€ 12345/         â† ç”¨æˆ· ID
    â”‚   â”‚   â”œâ”€â”€ image.jpg
    â”‚   â”‚   â””â”€â”€ audio.m4a
    â”‚   â””â”€â”€ 67890/
    â”‚       â””â”€â”€ video.mp4
    â””â”€â”€ 2024-01-16/
        â””â”€â”€ ...
```

**ç›®æ ‡ç»“æ„**:
```
vault/
â””â”€â”€ get/
    â””â”€â”€ get attachment/
        â”œâ”€â”€ 2024-01-15/
        â”‚   â”œâ”€â”€ image.jpg
        â”‚   â”œâ”€â”€ audio.m4a
        â”‚   â””â”€â”€ video.mp4
        â””â”€â”€ 2024-01-16/
            â””â”€â”€ ...
```

**å®ç°**:

```typescript
// lib/get/importer.ts

async copyAttachmentsSkipUserIdDir(
  srcDir: string,    // file/2024-01-15/
  destDir: string    // get attachment/2024-01-15/
) {
  const entries = await fs.readdir(srcDir, { withFileTypes: true });

  for (const entry of entries) {
    if (entry.isDirectory()) {
      // è¿™æ˜¯ç”¨æˆ· ID ç›®å½•ï¼Œè·³è¿‡ï¼Œç›´æ¥å¤„ç†å…¶å†…å®¹
      const userIdDir = path.join(srcDir, entry.name);
      const files = await fs.readdir(userIdDir);

      for (const file of files) {
        const srcFile = path.join(userIdDir, file);
        const destFile = path.join(destDir, file);

        await fs.copy(srcFile, destFile);
      }
    }
  }
}
```

---

## å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨ Playwrightï¼Ÿ

**é—®é¢˜**: Getç¬”è®° æ²¡æœ‰å…¬å¼€ API

**é€‰é¡¹**:
- âŒ ç½‘é¡µçˆ¬è™«ï¼šå®¹æ˜“è¢«åçˆ¬è™«æœºåˆ¶é˜»æ­¢
- âŒ é€†å‘å·¥ç¨‹ APIï¼šä¸ç¨³å®šï¼Œå¯èƒ½è¿åæœåŠ¡æ¡æ¬¾
- âœ… **æµè§ˆå™¨è‡ªåŠ¨åŒ–**ï¼šæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼Œç¨³å®šå¯é 

**ä¼˜ç‚¹**:
- ç¨³å®šæ€§é«˜
- æ”¯æŒè®¤è¯æµç¨‹
- å¯ä»¥å¤„ç† JavaScript æ¸²æŸ“çš„å†…å®¹

**ç¼ºç‚¹**:
- éœ€è¦ä¸‹è½½æµè§ˆå™¨ï¼ˆ~100MBï¼‰
- æ¡Œé¢ç«¯é™åˆ¶ï¼ˆç§»åŠ¨ç«¯ä¸æ”¯æŒï¼‰
- ç¨æ…¢ï¼ˆä½†å¯æ¥å—ï¼‰

---

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨å†…å®¹å“ˆå¸Œï¼Ÿ

**é—®é¢˜**: å¦‚ä½•è¯†åˆ«ç¬”è®°æ˜¯å¦è¢«ä¿®æ”¹ï¼Ÿ

**æ–¹æ¡ˆ**: æ—¶é—´æˆ³ + å†…å®¹å“ˆå¸Œ

```
æ—§æ–¹æ¡ˆï¼šåªç”¨æ—¶é—´æˆ³
é—®é¢˜ï¼šç”¨æˆ·ç¼–è¾‘ç¬”è®°åï¼Œæ—¶é—´æˆ³ä¸å˜ï¼Œæ— æ³•æ£€æµ‹æ›´æ–°

æ–°æ–¹æ¡ˆï¼šæ—¶é—´æˆ³ + å†…å®¹å“ˆå¸Œ
å¥½å¤„ï¼š
- å†…å®¹å˜åŒ– â†’ å“ˆå¸Œå˜åŒ– â†’ è¢«è¯†åˆ«ä¸ºæ–°ç¬”è®°
- è‡ªåŠ¨é‡æ–°å¯¼å…¥æ›´æ–°çš„å†…å®¹
```

---

### 3. ä¸ºä»€ä¹ˆåˆ†ç¦» Core å’Œ Importerï¼Ÿ

**è®¾è®¡åŸåˆ™**: å•ä¸€èŒè´£åŸåˆ™

```
GetCore:
- èŒè´£ï¼šè§£æ HTMLï¼Œæå–æ•°æ®
- è¾“å…¥ï¼šHTML å­—ç¬¦ä¸²
- è¾“å‡ºï¼šç»“æ„åŒ–æ•°æ®

GetImporter:
- èŒè´£ï¼šåè°ƒå¯¼å…¥æµç¨‹ï¼Œæ“ä½œæ–‡ä»¶ç³»ç»Ÿ
- ä¾èµ–ï¼šGetCore, Obsidian Vault API
- è¾“å‡ºï¼šVault ä¸­çš„æ–‡ä»¶
```

**å¥½å¤„**:
- æ˜“äºæµ‹è¯•ï¼ˆCore å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼‰
- èŒè´£æ¸…æ™°
- æ˜“äºæ‰©å±•ï¼ˆå¯ä»¥æ·»åŠ å…¶ä»– Importerï¼‰

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–

| åº“/æ¡†æ¶ | ç‰ˆæœ¬ | ç”¨é€” |
|--------|------|------|
| **Obsidian API** | latest | æ’ä»¶å¼€å‘æ¡†æ¶ |
| **Playwright** | 1.43.1 | æµè§ˆå™¨è‡ªåŠ¨åŒ– |
| **TypeScript** | ~4.7.0 | ç±»å‹å®‰å…¨å¼€å‘ |
| **node-html-parser** | ^6.1.4 | HTML è§£æ |
| **turndown** | ^7.1.2 | HTML â†’ Markdown |
| **uuid** | ^9.0.0 | UUID ç”Ÿæˆ |

### å¼€å‘å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| **esbuild** | å¿«é€Ÿæ„å»º |
| **gts** | Google TypeScript Style |
| **ESLint** | ä»£ç æ£€æŸ¥ |

### æ„å»ºæµç¨‹

```bash
TypeScript (.ts)
    â†“ (tsc - ç±»å‹æ£€æŸ¥)
    â†“ (esbuild - ç¼–è¯‘ + æ‰“åŒ…)
JavaScript (main.js)
    â†“ (å¤åˆ¶åˆ° vault)
Obsidian åŠ è½½
```

---

## æ€§èƒ½è€ƒè™‘

### 1. å†…å­˜ä¼˜åŒ–

- **æµå¼å¤„ç†**: é¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ç¬”è®°åˆ°å†…å­˜
- **åŠæ—¶é‡Šæ”¾**: å¤„ç†å®Œ HTML åç«‹å³é‡Šæ”¾
- **åˆ†æ‰¹å†™å…¥**: å¤§é‡ç¬”è®°æ—¶åˆ†æ‰¹å†™å…¥æ–‡ä»¶

### 2. é€Ÿåº¦ä¼˜åŒ–

- **å¹¶è¡Œé™„ä»¶ä¸‹è½½**: ä½¿ç”¨ Promise.all
- **ç¼“å­˜è®¤è¯**: é¿å…æ¯æ¬¡éƒ½ç™»å½•
- **å¢é‡åŒæ­¥**: åªå¤„ç†æ–°ç¬”è®°

### 3. å­˜å‚¨ä¼˜åŒ–

- **å‹ç¼©å›¾ç‰‡**: å¯é€‰åŠŸèƒ½ï¼ˆæœªå®ç°ï¼‰
- **æ¸…ç†æ—§æ–‡ä»¶**: å¯é€‰åŠŸèƒ½ï¼ˆæœªå®ç°ï¼‰

---

## å®‰å…¨è€ƒè™‘

### 1. è®¤è¯ä¿¡æ¯å­˜å‚¨

```
ä½ç½®: ~/.get/cache/playwright/get_auth.json
æƒé™: ä»…å½“å‰ç”¨æˆ·å¯è¯»
å†…å®¹: Playwright æµè§ˆå™¨çŠ¶æ€ï¼ˆcookies, localStorageï¼‰
```

### 2. æ•°æ®éšç§

- **æœ¬åœ°å¤„ç†**: æ‰€æœ‰æ•°æ®å¤„ç†åœ¨æœ¬åœ°å®Œæˆ
- **æ— äº‘ç«¯ä¼ è¾“**: ä¸ä¸Šä¼ ä»»ä½•æ•°æ®åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡å™¨
- **ç”¨æˆ·æ§åˆ¶**: ç”¨æˆ·å®Œå…¨æ§åˆ¶æ•°æ®å­˜å‚¨ä½ç½®

---

## é”™è¯¯å¤„ç†

### åˆ†å±‚é”™è¯¯å¤„ç†

```typescript
try {
  // 1. UI å±‚æ•è·
  const result = await importer.import();
} catch (error) {
  // 2. æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
  new Notice(`åŒæ­¥å¤±è´¥: ${error.message}`);

  // 3. è®°å½•è¯¦ç»†æ—¥å¿—
  console.error('Import error:', error);

  // 4. å›æ»šæ“ä½œï¼ˆå¦‚æœéœ€è¦ï¼‰
  await rollback();
}
```

### å¸¸è§é”™è¯¯ç±»å‹

1. **ç½‘ç»œé”™è¯¯**: é‡è¯•æœºåˆ¶
2. **è®¤è¯å¤±è´¥**: æç¤ºé‡æ–°ç™»å½•
3. **è§£æé”™è¯¯**: è®°å½•å¹¶è·³è¿‡ï¼Œç»§ç»­å¤„ç†å…¶ä»–ç¬”è®°
4. **æ–‡ä»¶ç³»ç»Ÿé”™è¯¯**: æ£€æŸ¥æƒé™ï¼Œæç¤ºç”¨æˆ·

---

## English

### System Overview

Getç¬”è®° Importer is an Obsidian plugin that syncs content from Getç¬”è®° to your Obsidian vault using browser automation (Playwright) to login, export data, parse HTML, and convert to Markdown.

### Architecture Principles

1. **Modular Design**: Clear separation of concerns
2. **Data-Driven**: Incremental sync based on unique IDs
3. **User-Friendly**: High automation, minimal user input
4. **Extensible**: Easy to add new visualizations or sync options

### Core Modules

- **UI Layer** (`lib/ui/`): User interface components
- **Core Logic** (`lib/get/`): Authentication, export, parsing, import
- **Integration** (`lib/obIntegration/`): Canvas and Moments generation
- **Entry Point** (`main.ts`): Plugin lifecycle and settings

### Data Flow

1. Trigger sync (manual/auto)
2. Check authentication
3. Login if needed
4. Export data via Playwright
5. Parse HTML
6. Generate unique IDs
7. Filter for new memos (incremental)
8. Convert to Markdown
9. Write to vault
10. Generate visualizations (optional)
11. Update sync state
12. Display results

### Key Algorithms

**Incremental Sync**: Uses `timestamp_contentHash_occurrence_total` format for unique memo IDs

**HTML Parsing**: Uses node-html-parser to extract memo data

**Attachment Handling**: Flattens 3-level export structure to 2-level vault structure

---

<div align="center">

**For detailed technical information, please refer to the Chinese version above**

Made with â¤ï¸ by the community

</div>
